{% extends "base.html" %}

{% block head_title %}Dashboard{% endblock %}
{% block extra_head %}{% endblock %}
{% block content %}
    <div class="row">

    <style media="screen">
      .week-commencing{
        margin-bottom: 1em;
        font-size: 0.9em;
        font-weight: 400;
      }

      ul.order{
        margin-left: 1em;
      }
      ul.order li{
        display: inline;
      }

      div.billing_week{
        /*margin-left: 1rem;*/
        /*margin-top: 2rem;*/
        border-top:1px solid #cacaca;
        min-height: 3em;
        padding: 1rem 1rem 0rem 1rem;
      }
      div.this_week{
        margin-left:0;
        padding-bottom: 1em;
        border-bottom:1px solid #cacaca;

      }

    </style>


      <h1>Dashboard</h1>

      <div id="message" class="greeting">
        <p>Hi {{ request.user.customer.nickname }}!</p>
      </div>


      <h4 class="font-display">Your Order</h4>

      {% for col in collections %}

        <div class="billing_week {% if col.billing_week == this_bw %} this_week  {% endif %} {% if col.skipped %} skipped {% endif %}">
            <div class="week-commencing">
              Week commencing {{ col.billing_week.mon }}:
            </div>


            {% if new_customer and col.billing_week == this_bw %}
            <h5>Welcome aboard! This week's order has already gone to the farmers, and your collections will start next week.</h5>
            {% elif col.skipped %}

            <h5>
              You've marked this week as on holiday, so there's no collection to pick up.
            </h5>

            {% else %}

            <h5>
              Available on
              <strong>
              {% for d in col.dates %}
                {% if forloop.counter == 2 %}
                  and
                {% endif %}
              {{ d }}{% endfor %},

              </strong>
                from
              <strong>
                {{ col.collection_point }}
              </strong>:
            </h5>


            <ul class="order">
            {% for bag_quantity in col.bags %}
              <li>{{ bag_quantity.quantity }} x {{ bag_quantity.bag_type.name }}</li>
            {% endfor %}
            </ul>

            {% endif %}
        </div>

        {% if forloop.first %}
          <h5 class="font-display">Upcoming collections</h5>
        {% endif %}

      {% endfor %}
            <p><em>Please check the opening days and hours of your collection point before collecting your order</em>.</p>

            {% if collection_point.instructions %}
              <div class="collection-point-info">
                <a href="#">See collection point instructions </a>
                <div class="instructions">
                  {{ collection_point.instructions|linebreaks }}
                </div>
              </div>
            {% endif %}



        </div>

      <div class="row">

        <ul class="menu">
          <li><a href="{% url 'dashboard_order_history' %}">Order History</a></li>
          {% if not user.customer.has_left %}
            <li><a href="{% url 'dashboard_skip_weeks' %}">Holidays</a></li>
          {% endif %}
          <li><a href="{% url 'dashboard_change_order' %}">Change Order</a></li>
          <li><a href="{% url 'dashboard_change_collection_point' %}">Change Collection Point</a></li>
          <li><a href="{% url 'dashboard_leave' %}">Leave</a></li>
        </ul>

      </div>

      <div class="row">

        <h4 class="font-display">your Account</h4>

        <ul class="menu">
          {% if not user.customer.has_left %}
            <li><a href="{% url 'account_email' %}">E-mail Addresses</a></li>
            <li><a href="{% url 'account_change_password' %}">Change Password</a></li>
            {% if user.customer.gocardless_current_mandate.gocardless_mandate_id %}
              <li><a href="{% url 'dashboard_bank_details' %}">Bank Details</a></li>
            {% endif %}
          {% endif %}
          <li><a href="{% url 'account_logout' %}">Log Out</a></li>
        </ul>

      </div>

    </div>
{% endblock %}
{% block extra_body %}
{% endblock %}
