{% extends "base.html" %}

{% block head_title %}Dashboard{% endblock %}
{% block extra_head %}{% endblock %}
{% block content %}
    <div class="row">

      <h1>Dashboard</h1>



      <div id="message">
        {% if new_customer %}
          It looks like you're a new customer.
        {% endif %}



        {% if skipped %}
          <div class="this_week">

            <p>Hi {{ request.user.customer.nickname }}!</p>

            <p class="skipped">
              There is nothing to pick up <span id="skipped-collection-date">{{ collection_date }}, as you marked this week as a holiday week.</span>
            </p>
            <p>
              <a href="{% url 'dashboard_skip_weeks' %}">See your holiday weeks</a>
            </p>
          </div>

          <div class="next_week">
            <p>
              next valid
            </p>
            <p>

              {{ next_valid_collection_date }}
              {{ next_valid_billing_week }}
            </p>

              <p>
                skipped weeks:
              </p>
              <p>
                {{ skipped_weeks }}

              </p>
          </div>

        {% else %}

          <div class="this_week">

            <p>Hi {{ request.user.customer.nickname }}!</p>

            <p>Your next collection is available on
              <span id="collection-date">{{ collection_date }}</span>
              from
              <strong id="collection-point">{{ collection_point.name }}</strong>
              :
            </p>

            <ul id="order">
            {% for bag_quantity in bag_quantities %}
              <li>{{ bag_quantity.quantity }} x {{ bag_quantity.bag_type.name }}</li>
            {% endfor %}
            </ul>

            {% if sent_to_growers %}
              <p>
                <em>We've now placed your order with the growers this week, so any changes to you make now will apply to next week's collection.</em>
              </p>
            {% endif %}

            <p><em>Please check the opening days and hours of your collection point before collecting your order</em>.</p>

            {% if collection_point.instructions %}
              <div class="collection-point-info">
                <a href="#">See collection point instructions </a>
                <div class="instructions">
                  {{ collection_point.instructions|linebreaks }}
                </div>
              </div>
            {% endif %}
          </div>


        {% endif %}
        </div>
      </div>

      <div class="row">

      <h4 class="font-display">Your Order</h4>

      <p>Any changes you make until <span id="deadline">{{ deadline }}</span> will affect <span id="changes-affect">{{ changes_affect }}</span></p>

      <ul class="menu">
        <li><a href="{% url 'dashboard_order_history' %}">Order History</a></li>
        {% if not user.customer.has_left %}
          <li><a href="{% url 'dashboard_skip_weeks' %}">Holidays</a></li>
        {% endif %}
        <li><a href="{% url 'dashboard_change_order' %}">Change Order</a></li>
        <li><a href="{% url 'dashboard_change_collection_point' %}">Change Collection Point</a></li>
        <li><a href="{% url 'dashboard_leave' %}">Leave</a></li>
      </ul>

      </div>

      <div class="row">

        <h4 class="font-display">your Account</h4>

        <ul class="menu">
          {% if not user.customer.has_left %}
            <li><a href="{% url 'account_email' %}">E-mail Addresses</a></li>
            <li><a href="{% url 'account_change_password' %}">Change Password</a></li>
            {% if user.customer.gocardless_current_mandate.gocardless_mandate_id %}
              <li><a href="{% url 'dashboard_bank_details' %}">Bank Details</a></li>
            {% endif %}
          {% endif %}
          <li><a href="{% url 'account_logout' %}">Log Out</a></li>
        </ul>


      </div>

    </div>
{% endblock %}
{% block extra_body %}
{% endblock %}
